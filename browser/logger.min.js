function Logger(){this.buffer=[],this.plugins={},this.url=_DEFAULTS.url,this.flushInterval=_DEFAULTS.flushInterval,this.collectMetrics=_DEFAULTS.collectMetrics,this.logLevels=_DEFAULTS.logLevels;}function sample(a){return Math.random()*100<a?!0:!1;}function intialize(){var a=new Logger();if(window){window.$logger=a;var b=window.onerror;window.onerror=function(){var c=Array.prototype.slice.call(arguments);return a.error(c),b?b.apply(window,c):!1;};}}var _DEFAULTS={url:'/api/log',flushInterval:1000,isInSampling:!0,samplingRate:100,collectMetrics:!0,logLevels:['log','info','warn','debug','error']};Logger.prototype.init=function(a){var b=this;a=a||_DEFAULTS,this.url=a.url||this.url,this.flushInterval=a.flushInterval||this.flushInterval,this.logLevels=a.logLevels||this.logLevels,this.collectMetrics=a.collectMetrics!==undefined?a.collectMetrics:this.collectMetrics;var c=a.isInSampling!==undefined?a.isInSampling:sample(a.samplingRate);console.log('Is in Sample: ',c);var d=this;if(c){var e=['log','info','warn','debug','error'];e.forEach(function(a){var b=console[a];console[a]=function(){var c=Array.prototype.slice.call(arguments);d[a](c),b.apply(console,c);};}),setInterval(function(){b.buffer.length>0&&b.flush();},a.flushInterval);}},Logger.prototype.registerPlugin=function(a,b){this.plugins[a]=b;},Logger.prototype.metrics=function(){if(!(window&&window.performance))return;var b=window.performance;var a=b.timing;var c=b.navigation;var d={navType:c.type,rc:c.redirectCount,lt:a.loadEventEnd-a.navigationStart,ct:a.responseEnd-a.requestStart,rt:a.domComplete-a.domLoading};return d;},Logger.prototype.log=function(){this.addToQ('LOG',arguments);},Logger.prototype.info=function(){this.addToQ('INFO',arguments);},Logger.prototype.debug=function(){this.addToQ('DEBUG',arguments);},Logger.prototype.warn=function(){this.addToQ('WARN',arguments);},Logger.prototype.error=function(){var a=[];Array.prototype.slice.call(arguments[0]).forEach(function(b){typeof b==='object'&&b.stack?a.push(b.stack):a.push(b);}),this.addToQ('ERROR',a);},Logger.prototype.clearBuffer=function(a){this.buffer=this.buffer.slice(a);},Logger.prototype.addToQ=function(a,b){if(this.logLevels.indexOf(a)>-1||this.logLevels.indexOf(a.toLowerCase())>-1){var c=b.length>0&&[].join.call(b,' ')||'';this.buffer.push({level:a,msg:c});}},Logger.prototype.flush=function(){var a=this;if(a.buffer.length<1)return;var d=a.buffer.length;var c={metrics:a.metrics(),logs:a.buffer};if(Object.keys(a.plugins).forEach(function(b){a.plugins[b](c);}),navigator&&navigator.sendBeacon){var e=navigator.sendBeacon(a.url,JSON.stringify(c));e&&a.clearBuffer(d);}else{var b=new XMLHttpRequest();b.open('POST',this.url,!0),b.setRequestHeader('Content-Type','text/plain'),b.onreadystatechange=function(){b.readyState==4&&b.status==200&&a.clearBuffer(d);},b.send(JSON.stringify(c));}},intialize();